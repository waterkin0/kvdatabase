# KV存储引擎

实现了类似redis内的跳表结构

支持对这个数据库的插入数据、删除数据、查询数据、数据长期存储、文件加载数据，以及数据库大小和结构显示

基于java编写,GBK编码

## 文件结构

* data： 数据库内的数据被长期保存在这
* SkipList： 关于节点类和跳表类的具体实现
* test.java：对这个数据库进行操作

## 简单说说

有关具体实现代码里写的很详细了

关于跳表的实现，我所看到的有两种：

1.分层，每一层都是一个数组，可以单独对某一层进行操作，比如遍历的时候可以直接读取最下面的那层

2.一体，不想上面那种，每个节点都有down和next两个方向，这种结构就是简单而且易于理解，但也没上面那种方便，这里采用的第二种

然后看到有部分跳表都是在上层也存value，没想明白为啥，可能为了减少检索时间，但这样明显要存大量重复数据，有点浪费空间，个人觉得没这个必要，除了最下面那层真的需要value，上面的基本都是起引导作用，没必要去存value

其次就是关于这个跳表的存储，可以只存数据，也就是最下面那层的，存和读取都简单，然后就是也要存结构，也就是全都存进去

本来是想都实现的，但是这里只实现了存数据的，因为实际写的时候发现，如果结构一起存的话，读取也要对整个跳表进行重构，并没有节约多少时间

相比于常见的key只能是Integer, 本项目的key可以是string，string利用了hashcode进行编码变为Integer从而进行排序

## 遇到的小问题

1. get_value遍历查找的时候一开始key匹配就直接返回了，但忘记了key匹配也可能是在上层，即value为null
2. 之前偶尔会出现查找失败的情况，检查才发现有一行赋值出错导致表结构错了，每一层的结尾的down连到了下一层的开头
3. 偶尔会出现删除一个元素后在遍历的时候返回null的现象，原因是因为原来的最上面的那层只有要删除的这个元素，删除之后头没下降，导致判断出错
4. 说实话，java的泛型出发点是好的，和c的模板一样，但相比c实际用起来就是一坨，我在读取数据的时候不能得到当前的跳表泛型的实际类型，从而无法进行赋值（当然想获取泛型类型也可以，但是太复杂了），解决办法是在储存的时候存一下这个类型
   但是如你所见还是会出现警告，我实在没办法解决了

还可以优化的地方：

1. 在以string作为key的时候，虽然大部分情况下是正常的，但仍然可能会出现问题，不推荐用string作为key
2. UTF-8编码会出现读取错误，原因未知，改用GBK
3. 当读取文件的类型和你开始定义的不一致的时候会出现存储的数据出错，希望可以

# 后记

最近在学习java和数据库，于是就找了这么一个项目来练手，还有很多不足，希望各位谅解
